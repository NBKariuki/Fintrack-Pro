<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FinTrack Pro</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lucide@0.263.1/dist/umd/lucide.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Urbanist:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const { 
            Wallet, TrendingUp, TrendingDown, ShoppingCart, FolderKanban, 
            Settings, Calendar, Plus, X, Check, Bell, ChevronDown, 
            Smartphone, Building2, DollarSign, Filter, Download,
            Edit3, Trash2, Save, Home, BarChart3, Eye, EyeOff,
            AlertCircle, CheckCircle2
        } = lucide;

        // Theme configurations
        const THEMES = {
            mint: {
                name: 'Mint Fresh',
                primary: '#10b981',
                primaryDark: '#059669',
                background: '#f0fdf4',
                surface: '#ffffff',
                text: '#064e3b',
                textSecondary: '#047857',
                accent: '#34d399',
                danger: '#ef4444',
                success: '#10b981',
                border: '#d1fae5'
            },
            ocean: {
                name: 'Deep Ocean',
                primary: '#0ea5e9',
                primaryDark: '#0284c7',
                background: '#f0f9ff',
                surface: '#ffffff',
                text: '#0c4a6e',
                textSecondary: '#0369a1',
                accent: '#38bdf8',
                danger: '#ef4444',
                success: '#10b981',
                border: '#bae6fd'
            },
            sunset: {
                name: 'Sunset Glow',
                primary: '#f97316',
                primaryDark: '#ea580c',
                background: '#fff7ed',
                surface: '#ffffff',
                text: '#7c2d12',
                textSecondary: '#c2410c',
                accent: '#fb923c',
                danger: '#dc2626',
                success: '#10b981',
                border: '#fed7aa'
            },
            dark: {
                name: 'Dark Mode',
                primary: '#8b5cf6',
                primaryDark: '#7c3aed',
                background: '#0f172a',
                surface: '#1e293b',
                text: '#f1f5f9',
                textSecondary: '#cbd5e1',
                accent: '#a78bfa',
                danger: '#f87171',
                success: '#34d399',
                border: '#334155'
            },
            purple: {
                name: 'Purple Haze',
                primary: '#a855f7',
                primaryDark: '#9333ea',
                background: '#faf5ff',
                surface: '#ffffff',
                text: '#581c87',
                textSecondary: '#7e22ce',
                accent: '#c084fc',
                danger: '#ef4444',
                success: '#10b981',
                border: '#e9d5ff'
            }
        };

        // Mock M-PESA SMS messages for demo
        const MOCK_MPESA_MESSAGES = [
            {
                id: 1,
                text: "RK12ABC123 Confirmed. Ksh5,000.00 received from JOHN DOE 254712345678 on 12/2/26 at 2:30 PM. New M-PESA balance is Ksh15,300.00. Transaction cost, Ksh0.00.",
                timestamp: new Date('2026-02-12T14:30:00'),
                parsed: false
            },
            {
                id: 2,
                text: "RK12DEF456 Confirmed. Ksh800.00 paid to NAIVAS SUPERMARKET. on 12/2/26 at 3:45 PM. New M-PESA balance is Ksh14,500.00. Transaction cost, Ksh0.00.",
                timestamp: new Date('2026-02-12T15:45:00'),
                parsed: false
            },
            {
                id: 3,
                text: "RK12GHI789 Confirmed. You have sent Ksh2,500.00 to JANE MWANGI 254798765432 on 12/2/26 at 4:15 PM. New M-PESA balance is Ksh12,000.00. Transaction cost, Ksh0.00.",
                timestamp: new Date('2026-02-12T16:15:00'),
                parsed: false
            }
        ];

        // M-PESA Parser
        const parseMpesaMessage = (text) => {
            const patterns = {
                received: /received\s+(?:Ksh)?([0-9,]+\.?\d*)\s+from\s+([A-Z\s]+)\s+(\d+)/i,
                sent: /sent\s+(?:Ksh)?([0-9,]+\.?\d*)\s+to\s+([A-Z\s]+)\s+(\d+)/i,
                paid: /(?:Ksh)?([0-9,]+\.?\d*)\s+paid to\s+([A-Z\s]+)/i,
                withdrawn: /(?:Ksh)?([0-9,]+\.?\d*)\s+withdrawn from/i,
                balance: /New M-PESA balance is\s+(?:Ksh)?([0-9,]+\.?\d*)/i,
                date: /(\d{1,2}\/\d{1,2}\/\d{2,4})\s+at\s+(\d{1,2}:\d{2}\s*[AP]M)/i
            };

            let type = 'unknown';
            let amount = 0;
            let contact = '';
            let balance = 0;
            let suggestedCategory = 'Other';
            let isIncome = false;

            // Determine transaction type and extract details
            if (patterns.received.test(text)) {
                const match = text.match(patterns.received);
                type = 'received';
                amount = parseFloat(match[1].replace(/,/g, ''));
                contact = match[2].trim();
                isIncome = true;
                suggestedCategory = 'Income';
            } else if (patterns.sent.test(text)) {
                const match = text.match(patterns.sent);
                type = 'sent';
                amount = parseFloat(match[1].replace(/,/g, ''));
                contact = match[2].trim();
                suggestedCategory = 'Black Tax';
            } else if (patterns.paid.test(text)) {
                const match = text.match(patterns.paid);
                type = 'paid';
                amount = parseFloat(match[1].replace(/,/g, ''));
                contact = match[2].trim();
                
                // Auto-categorize based on merchant
                const merchantLower = contact.toLowerCase();
                if (merchantLower.includes('naivas') || merchantLower.includes('carrefour') || 
                    merchantLower.includes('quickmart') || merchantLower.includes('supermarket')) {
                    suggestedCategory = 'Food';
                } else if (merchantLower.includes('kplc') || merchantLower.includes('water')) {
                    suggestedCategory = 'Utilities';
                } else if (merchantLower.includes('uber') || merchantLower.includes('bolt') || 
                          merchantLower.includes('matatu')) {
                    suggestedCategory = 'Transport';
                } else {
                    suggestedCategory = 'Other';
                }
            } else if (patterns.withdrawn.test(text)) {
                const match = text.match(patterns.withdrawn);
                type = 'withdrawn';
                amount = parseFloat(match[1].replace(/,/g, ''));
                contact = 'ATM Withdrawal';
                suggestedCategory = 'Cash Withdrawal';
            }

            // Extract balance
            if (patterns.balance.test(text)) {
                const match = text.match(patterns.balance);
                balance = parseFloat(match[1].replace(/,/g, ''));
            }

            return {
                type,
                amount,
                contact,
                balance,
                suggestedCategory,
                isIncome,
                rawText: text
            };
        };

        // Main App Component
        function FinTrackApp() {
            const [currentTheme, setCurrentTheme] = useState('mint');
            const [activeTab, setActiveTab] = useState('home');
            const [selectedDate, setSelectedDate] = useState(new Date());
            const [showAddModal, setShowAddModal] = useState(null);
            const [pendingMpesa, setPendingMpesa] = useState([]);
            const [showPendingNotification, setShowPendingNotification] = useState(false);
            
            // Data states
            const [incomes, setIncomes] = useState([]);
            const [expenses, setExpenses] = useState([]);
            const [shoppingLists, setShoppingLists] = useState([]);
            const [projects, setProjects] = useState([]);
            const [categories, setCategories] = useState([
                'Food', 'Transport', 'Clothes', 'Snacks', 'Black Tax', 'Rent', 
                'Utilities', 'Entertainment', 'Other'
            ]);
            const [activeShoppingList, setActiveShoppingList] = useState(null);
            const [activeProject, setActiveProject] = useState(null);

            const theme = THEMES[currentTheme];

            // Simulate M-PESA message arrival
            useEffect(() => {
                const timer = setTimeout(() => {
                    const unprocessed = MOCK_MPESA_MESSAGES.filter(msg => !msg.parsed);
                    if (unprocessed.length > 0) {
                        const parsed = unprocessed.map(msg => ({
                            ...msg,
                            ...parseMpesaMessage(msg.text),
                            parsed: true
                        }));
                        setPendingMpesa(parsed);
                        setShowPendingNotification(true);
                    }
                }, 2000);

                return () => clearTimeout(timer);
            }, []);

            // Calculate totals
            const calculateTotals = () => {
                const today = selectedDate.toDateString();
                
                const todayIncomes = incomes.filter(i => 
                    new Date(i.date).toDateString() === today
                );
                const todayExpenses = expenses.filter(e => 
                    new Date(e.date).toDateString() === today
                );

                const incomeSources = {
                    bank: todayIncomes.filter(i => i.source === 'Bank').reduce((sum, i) => sum + i.amount, 0),
                    mpesa: todayIncomes.filter(i => i.source === 'M-PESA').reduce((sum, i) => sum + i.amount, 0),
                    cash: todayIncomes.filter(i => i.source === 'Cash').reduce((sum, i) => sum + i.amount, 0)
                };

                const totalIncome = Object.values(incomeSources).reduce((sum, val) => sum + val, 0);
                const totalExpense = todayExpenses.reduce((sum, e) => sum + e.amount, 0);

                return { incomeSources, totalIncome, totalExpense };
            };

            const totals = calculateTotals();

            // Handle M-PESA confirmation
            const handleConfirmMpesa = (transaction, category) => {
                if (transaction.isIncome) {
                    setIncomes([...incomes, {
                        id: Date.now(),
                        source: 'M-PESA',
                        amount: transaction.amount,
                        description: `Received from ${transaction.contact}`,
                        date: transaction.timestamp,
                        mpesaBalance: transaction.balance
                    }]);
                } else {
                    setExpenses([...expenses, {
                        id: Date.now(),
                        category: category,
                        amount: transaction.amount,
                        description: transaction.contact,
                        date: transaction.timestamp,
                        source: 'M-PESA'
                    }]);
                }

                setPendingMpesa(pendingMpesa.filter(t => t.id !== transaction.id));
                if (pendingMpesa.length <= 1) {
                    setShowPendingNotification(false);
                }
            };

            const handleDismissMpesa = (transactionId) => {
                setPendingMpesa(pendingMpesa.filter(t => t.id !== transactionId));
                if (pendingMpesa.length <= 1) {
                    setShowPendingNotification(false);
                }
            };

            return (
                <div style={{
                    fontFamily: "'Urbanist', sans-serif",
                    minHeight: '100vh',
                    background: theme.background,
                    color: theme.text,
                    transition: 'all 0.3s ease'
                }}>
                    {/* M-PESA Notification */}
                    {showPendingNotification && pendingMpesa.length > 0 && (
                        <MpesaNotificationPanel
                            transactions={pendingMpesa}
                            theme={theme}
                            categories={categories}
                            onConfirm={handleConfirmMpesa}
                            onDismiss={handleDismissMpesa}
                            onClose={() => setShowPendingNotification(false)}
                        />
                    )}

                    {/* Header */}
                    <header style={{
                        background: theme.surface,
                        padding: '16px 20px',
                        borderBottom: `2px solid ${theme.border}`,
                        display: 'flex',
                        justifyContent: 'space-between',
                        alignItems: 'center',
                        boxShadow: '0 2px 8px rgba(0,0,0,0.05)'
                    }}>
                        <div>
                            <h1 style={{
                                margin: 0,
                                fontSize: '24px',
                                fontWeight: 800,
                                background: `linear-gradient(135deg, ${theme.primary}, ${theme.accent})`,
                                WebkitBackgroundClip: 'text',
                                WebkitTextFillColor: 'transparent'
                            }}>FinTrack</h1>
                            <p style={{
                                margin: '2px 0 0 0',
                                fontSize: '12px',
                                color: theme.textSecondary,
                                fontWeight: 500
                            }}>Smart Money Management</p>
                        </div>
                        
                        <div style={{ display: 'flex', gap: '12px', alignItems: 'center' }}>
                            {pendingMpesa.length > 0 && (
                                <button
                                    onClick={() => setShowPendingNotification(true)}
                                    style={{
                                        background: theme.accent,
                                        border: 'none',
                                        borderRadius: '12px',
                                        padding: '8px 12px',
                                        cursor: 'pointer',
                                        display: 'flex',
                                        alignItems: 'center',
                                        gap: '6px',
                                        position: 'relative',
                                        animation: 'pulse 2s infinite'
                                    }}
                                >
                                    <Bell size={18} color={theme.surface} />
                                    <span style={{
                                        position: 'absolute',
                                        top: '4px',
                                        right: '4px',
                                        background: theme.danger,
                                        color: 'white',
                                        borderRadius: '50%',
                                        width: '18px',
                                        height: '18px',
                                        fontSize: '11px',
                                        fontWeight: 700,
                                        display: 'flex',
                                        alignItems: 'center',
                                        justifyContent: 'center'
                                    }}>{pendingMpesa.length}</span>
                                </button>
                            )}
                            <ThemeSelector
                                currentTheme={currentTheme}
                                onChange={setCurrentTheme}
                                theme={theme}
                            />
                        </div>
                    </header>

                    {/* Main Content */}
                    <main style={{ padding: '0 0 80px 0' }}>
                        {activeTab === 'home' && (
                            <HomePage
                                theme={theme}
                                totals={totals}
                                selectedDate={selectedDate}
                                onDateChange={setSelectedDate}
                                onAddIncome={() => setShowAddModal('income')}
                                onAddExpense={() => setShowAddModal('expense')}
                                onAddShoppingList={() => setShowAddModal('shopping')}
                            />
                        )}
                        {activeTab === 'analytics' && (
                            <AnalyticsPage
                                theme={theme}
                                incomes={incomes}
                                expenses={expenses}
                            />
                        )}
                        {activeTab === 'shopping' && (
                            <ShoppingPage
                                theme={theme}
                                shoppingLists={shoppingLists}
                                setShoppingLists={setShoppingLists}
                                activeShoppingList={activeShoppingList}
                                setActiveShoppingList={setActiveShoppingList}
                                onAddToExpenses={(items, total) => {
                                    setExpenses([...expenses, {
                                        id: Date.now(),
                                        category: 'Food',
                                        amount: total,
                                        description: `Shopping: ${items.length} items`,
                                        date: new Date(),
                                        source: 'Shopping List'
                                    }]);
                                }}
                            />
                        )}
                        {activeTab === 'projects' && (
                            <ProjectsPage
                                theme={theme}
                                projects={projects}
                                setProjects={setProjects}
                                activeProject={activeProject}
                                setActiveProject={setActiveProject}
                            />
                        )}
                        {activeTab === 'settings' && (
                            <SettingsPage
                                theme={theme}
                                categories={categories}
                                setCategories={setCategories}
                            />
                        )}
                    </main>

                    {/* Bottom Navigation */}
                    <nav style={{
                        position: 'fixed',
                        bottom: 0,
                        left: 0,
                        right: 0,
                        background: theme.surface,
                        borderTop: `2px solid ${theme.border}`,
                        display: 'flex',
                        justifyContent: 'space-around',
                        padding: '12px 0 8px 0',
                        boxShadow: '0 -2px 12px rgba(0,0,0,0.08)'
                    }}>
                        {[
                            { id: 'home', icon: Home, label: 'Home' },
                            { id: 'shopping', icon: ShoppingCart, label: 'Shopping' },
                            { id: 'projects', icon: FolderKanban, label: 'Projects' },
                            { id: 'settings', icon: Settings, label: 'Settings' }
                        ].map(tab => (
                            <button
                                key={tab.id}
                                onClick={() => setActiveTab(tab.id)}
                                style={{
                                    background: 'none',
                                    border: 'none',
                                    cursor: 'pointer',
                                    display: 'flex',
                                    flexDirection: 'column',
                                    alignItems: 'center',
                                    gap: '4px',
                                    padding: '8px 16px',
                                    borderRadius: '12px',
                                    transition: 'all 0.2s ease',
                                    color: activeTab === tab.id ? theme.primary : theme.textSecondary
                                }}
                            >
                                <tab.icon size={22} strokeWidth={activeTab === tab.id ? 2.5 : 2} />
                                <span style={{
                                    fontSize: '11px',
                                    fontWeight: activeTab === tab.id ? 700 : 500
                                }}>{tab.label}</span>
                            </button>
                        ))}
                    </nav>

                    {/* Modals */}
                    {showAddModal === 'income' && (
                        <AddIncomeModal
                            theme={theme}
                            onClose={() => setShowAddModal(null)}
                            onSave={(income) => {
                                setIncomes([...incomes, { ...income, id: Date.now(), date: selectedDate }]);
                                setShowAddModal(null);
                            }}
                        />
                    )}
                    {showAddModal === 'expense' && (
                        <AddExpenseModal
                            theme={theme}
                            categories={categories}
                            onClose={() => setShowAddModal(null)}
                            onSave={(expense) => {
                                setExpenses([...expenses, { ...expense, id: Date.now(), date: selectedDate }]);
                                setShowAddModal(null);
                            }}
                        />
                    )}
                    {showAddModal === 'shopping' && (
                        <CreateShoppingListModal
                            theme={theme}
                            onClose={() => setShowAddModal(null)}
                            onCreate={(list) => {
                                const newList = {
                                    ...list,
                                    id: Date.now(),
                                    createdDate: new Date(),
                                    items: [],
                                    completed: false
                                };
                                setShoppingLists([...shoppingLists, newList]);
                                setActiveShoppingList(newList.id);
                                setActiveTab('shopping');
                                setShowAddModal(null);
                            }}
                        />
                    )}

                    <style>{`
                        @keyframes pulse {
                            0%, 100% { transform: scale(1); }
                            50% { transform: scale(1.05); }
                        }
                        * { box-sizing: border-box; }
                        body { margin: 0; padding: 0; }
                        button { font-family: 'Urbanist', sans-serif; }
                        input, select, textarea { font-family: 'Urbanist', sans-serif; }
                    `}</style>
                </div>
            );
        }

        // M-PESA Notification Panel Component
        function MpesaNotificationPanel({ transactions, theme, categories, onConfirm, onDismiss, onClose }) {
            const [currentIndex, setCurrentIndex] = useState(0);
            const [selectedCategory, setSelectedCategory] = useState(transactions[0]?.suggestedCategory || 'Other');

            const currentTransaction = transactions[currentIndex];

            useEffect(() => {
                setSelectedCategory(currentTransaction?.suggestedCategory || 'Other');
            }, [currentIndex, currentTransaction]);

            if (!currentTransaction) return null;

            return (
                <div style={{
                    position: 'fixed',
                    top: 0,
                    left: 0,
                    right: 0,
                    bottom: 0,
                    background: 'rgba(0,0,0,0.6)',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    zIndex: 1000,
                    padding: '20px',
                    backdropFilter: 'blur(4px)'
                }}>
                    <div style={{
                        background: theme.surface,
                        borderRadius: '20px',
                        padding: '24px',
                        maxWidth: '400px',
                        width: '100%',
                        boxShadow: '0 20px 60px rgba(0,0,0,0.3)',
                        animation: 'slideUp 0.3s ease'
                    }}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px' }}>
                            <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>
                                <div style={{
                                    background: theme.primary,
                                    borderRadius: '12px',
                                    padding: '8px',
                                    display: 'flex'
                                }}>
                                    <Smartphone size={24} color={theme.surface} />
                                </div>
                                <div>
                                    <h3 style={{ margin: 0, fontSize: '18px', fontWeight: 700 }}>M-PESA Transaction</h3>
                                    <p style={{ margin: '2px 0 0 0', fontSize: '12px', color: theme.textSecondary }}>
                                        {currentIndex + 1} of {transactions.length}
                                    </p>
                                </div>
                            </div>
                            <button
                                onClick={onClose}
                                style={{
                                    background: 'none',
                                    border: 'none',
                                    cursor: 'pointer',
                                    padding: '4px'
                                }}
                            >
                                <X size={24} color={theme.textSecondary} />
                            </button>
                        </div>

                        <div style={{
                            background: theme.background,
                            borderRadius: '12px',
                            padding: '16px',
                            marginBottom: '20px'
                        }}>
                            <div style={{ marginBottom: '12px' }}>
                                <p style={{ 
                                    margin: '0 0 4px 0', 
                                    fontSize: '12px', 
                                    color: theme.textSecondary,
                                    fontWeight: 600,
                                    textTransform: 'uppercase',
                                    letterSpacing: '0.5px'
                                }}>Amount</p>
                                <p style={{
                                    margin: 0,
                                    fontSize: '32px',
                                    fontWeight: 800,
                                    color: currentTransaction.isIncome ? theme.success : theme.text,
                                    fontFamily: "'JetBrains Mono', monospace"
                                }}>
                                    {currentTransaction.isIncome ? '+' : '-'} KES {currentTransaction.amount.toLocaleString()}
                                </p>
                            </div>
                            
                            <div style={{ marginBottom: '8px' }}>
                                <p style={{ margin: '0 0 4px 0', fontSize: '12px', color: theme.textSecondary, fontWeight: 600 }}>
                                    {currentTransaction.isIncome ? 'From' : 'To'}
                                </p>
                                <p style={{ margin: 0, fontSize: '16px', fontWeight: 600 }}>{currentTransaction.contact}</p>
                            </div>

                            <div>
                                <p style={{ margin: '0 0 4px 0', fontSize: '12px', color: theme.textSecondary, fontWeight: 600 }}>Type</p>
                                <p style={{ 
                                    margin: 0, 
                                    fontSize: '14px',
                                    textTransform: 'capitalize',
                                    color: theme.primary,
                                    fontWeight: 600
                                }}>{currentTransaction.type}</p>
                            </div>
                        </div>

                        {!currentTransaction.isIncome && (
                            <div style={{ marginBottom: '20px' }}>
                                <label style={{
                                    display: 'block',
                                    marginBottom: '8px',
                                    fontSize: '14px',
                                    fontWeight: 600,
                                    color: theme.textSecondary
                                }}>
                                    Category
                                </label>
                                <select
                                    value={selectedCategory}
                                    onChange={(e) => setSelectedCategory(e.target.value)}
                                    style={{
                                        width: '100%',
                                        padding: '12px 16px',
                                        borderRadius: '12px',
                                        border: `2px solid ${theme.border}`,
                                        background: theme.surface,
                                        color: theme.text,
                                        fontSize: '16px',
                                        fontWeight: 600,
                                        cursor: 'pointer'
                                    }}
                                >
                                    {categories.map(cat => (
                                        <option key={cat} value={cat}>{cat}</option>
                                    ))}
                                </select>
                                <p style={{
                                    margin: '6px 0 0 0',
                                    fontSize: '12px',
                                    color: theme.primary,
                                    fontWeight: 500
                                }}>
                                    ✓ Auto-suggested: {currentTransaction.suggestedCategory}
                                </p>
                            </div>
                        )}

                        <div style={{ display: 'flex', gap: '12px' }}>
                            <button
                                onClick={() => onDismiss(currentTransaction.id)}
                                style={{
                                    flex: 1,
                                    padding: '14px',
                                    borderRadius: '12px',
                                    border: `2px solid ${theme.border}`,
                                    background: theme.surface,
                                    color: theme.text,
                                    fontSize: '16px',
                                    fontWeight: 700,
                                    cursor: 'pointer',
                                    transition: 'all 0.2s ease'
                                }}
                            >
                                Ignore
                            </button>
                            <button
                                onClick={() => {
                                    onConfirm(currentTransaction, selectedCategory);
                                    if (currentIndex < transactions.length - 1) {
                                        setCurrentIndex(currentIndex + 1);
                                    }
                                }}
                                style={{
                                    flex: 2,
                                    padding: '14px',
                                    borderRadius: '12px',
                                    border: 'none',
                                    background: `linear-gradient(135deg, ${theme.primary}, ${theme.primaryDark})`,
                                    color: theme.surface,
                                    fontSize: '16px',
                                    fontWeight: 700,
                                    cursor: 'pointer',
                                    boxShadow: `0 4px 12px ${theme.primary}40`,
                                    transition: 'all 0.2s ease'
                                }}
                            >
                                <CheckCircle2 size={18} style={{ verticalAlign: 'middle', marginRight: '6px' }} />
                                Confirm & Log
                            </button>
                        </div>
                    </div>

                    <style>{`
                        @keyframes slideUp {
                            from { transform: translateY(20px); opacity: 0; }
                            to { transform: translateY(0); opacity: 1; }
                        }
                    `}</style>
                </div>
            );
        }

        // Home Page Component
        function HomePage({ theme, totals, selectedDate, onDateChange, onAddIncome, onAddExpense, onAddShoppingList }) {
            const formatDate = (date) => {
                return date.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
            };

            return (
                <div style={{ padding: '20px' }}>
                    {/* Date Selector */}
                    <div style={{
                        background: theme.surface,
                        borderRadius: '16px',
                        padding: '16px',
                        marginBottom: '20px',
                        boxShadow: '0 2px 8px rgba(0,0,0,0.05)'
                    }}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                            <button
                                onClick={() => {
                                    const newDate = new Date(selectedDate);
                                    newDate.setDate(newDate.getDate() - 1);
                                    onDateChange(newDate);
                                }}
                                style={{
                                    background: theme.background,
                                    border: 'none',
                                    borderRadius: '10px',
                                    padding: '8px 12px',
                                    cursor: 'pointer',
                                    fontWeight: 600,
                                    color: theme.textSecondary
                                }}
                            >← Prev</button>
                            
                            <div style={{ textAlign: 'center' }}>
                                <p style={{ margin: 0, fontSize: '18px', fontWeight: 700, color: theme.text }}>
                                    {formatDate(selectedDate)}
                                </p>
                                <p style={{ margin: '2px 0 0 0', fontSize: '12px', color: theme.textSecondary }}>
                                    {selectedDate.toDateString() === new Date().toDateString() ? 'Today' : ''}
                                </p>
                            </div>

                            <button
                                onClick={() => {
                                    const newDate = new Date(selectedDate);
                                    newDate.setDate(newDate.getDate() + 1);
                                    onDateChange(newDate);
                                }}
                                style={{
                                    background: theme.background,
                                    border: 'none',
                                    borderRadius: '10px',
                                    padding: '8px 12px',
                                    cursor: 'pointer',
                                    fontWeight: 600,
                                    color: theme.textSecondary
                                }}
                            >Next →</button>
                        </div>
                    </div>

                    {/* Balance Summary */}
                    <div style={{
                        background: `linear-gradient(135deg, ${theme.primary}, ${theme.primaryDark})`,
                        borderRadius: '20px',
                        padding: '24px',
                        marginBottom: '20px',
                        color: theme.surface,
                        boxShadow: `0 8px 24px ${theme.primary}40`
                    }}>
                        <p style={{ margin: '0 0 8px 0', fontSize: '14px', opacity: 0.9, fontWeight: 600 }}>Net Balance Today</p>
                        <h2 style={{
                            margin: '0 0 16px 0',
                            fontSize: '40px',
                            fontWeight: 800,
                            fontFamily: "'JetBrains Mono', monospace"
                        }}>
                            KES {(totals.totalIncome - totals.totalExpense).toLocaleString()}
                        </h2>
                        <div style={{ display: 'flex', gap: '16px', fontSize: '14px' }}>
                            <div>
                                <TrendingUp size={16} style={{ verticalAlign: 'middle', marginRight: '4px' }} />
                                <span style={{ fontWeight: 600 }}>+{totals.totalIncome.toLocaleString()}</span>
                            </div>
                            <div>
                                <TrendingDown size={16} style={{ verticalAlign: 'middle', marginRight: '4px' }} />
                                <span style={{ fontWeight: 600 }}>-{totals.totalExpense.toLocaleString()}</span>
                            </div>
                        </div>
                    </div>

                    {/* Income Sources */}
                    <div style={{ marginBottom: '20px' }}>
                        <h3 style={{ fontSize: '16px', fontWeight: 700, marginBottom: '12px', color: theme.text }}>
                            Income Sources
                        </h3>
                        <div style={{ display: 'grid', gap: '12px' }}>
                            {[
                                { label: 'Bank', amount: totals.incomeSources.bank, icon: Building2 },
                                { label: 'M-PESA', amount: totals.incomeSources.mpesa, icon: Smartphone },
                                { label: 'Cash', amount: totals.incomeSources.cash, icon: Wallet }
                            ].map(source => (
                                <div key={source.label} style={{
                                    background: theme.surface,
                                    borderRadius: '12px',
                                    padding: '16px',
                                    display: 'flex',
                                    justifyContent: 'space-between',
                                    alignItems: 'center',
                                    boxShadow: '0 2px 8px rgba(0,0,0,0.05)'
                                }}>
                                    <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
                                        <div style={{
                                            background: theme.background,
                                            borderRadius: '10px',
                                            padding: '10px',
                                            display: 'flex'
                                        }}>
                                            <source.icon size={20} color={theme.primary} />
                                        </div>
                                        <span style={{ fontWeight: 600, fontSize: '15px' }}>{source.label}</span>
                                    </div>
                                    <span style={{
                                        fontWeight: 700,
                                        fontSize: '18px',
                                        fontFamily: "'JetBrains Mono', monospace"
                                    }}>
                                        {source.amount.toLocaleString()}
                                    </span>
                                </div>
                            ))}
                        </div>
                    </div>

                    {/* Quick Actions */}
                    <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '12px', marginBottom: '12px' }}>
                        <button
                            onClick={onAddIncome}
                            style={{
                                background: theme.success,
                                color: 'white',
                                border: 'none',
                                borderRadius: '16px',
                                padding: '20px',
                                cursor: 'pointer',
                                fontSize: '16px',
                                fontWeight: 700,
                                display: 'flex',
                                flexDirection: 'column',
                                alignItems: 'center',
                                gap: '8px',
                                boxShadow: `0 4px 12px ${theme.success}40`,
                                transition: 'transform 0.2s ease'
                            }}
                        >
                            <Plus size={24} />
                            Add Income
                        </button>
                        <button
                            onClick={onAddExpense}
                            style={{
                                background: theme.danger,
                                color: 'white',
                                border: 'none',
                                borderRadius: '16px',
                                padding: '20px',
                                cursor: 'pointer',
                                fontSize: '16px',
                                fontWeight: 700,
                                display: 'flex',
                                flexDirection: 'column',
                                alignItems: 'center',
                                gap: '8px',
                                boxShadow: `0 4px 12px ${theme.danger}40`,
                                transition: 'transform 0.2s ease'
                            }}
                        >
                            <Plus size={24} />
                            Add Expense
                        </button>
                    </div>
                    
                    <button
                        onClick={onAddShoppingList}
                        style={{
                            width: '100%',
                            background: theme.accent,
                            color: theme.surface,
                            border: 'none',
                            borderRadius: '16px',
                            padding: '20px',
                            cursor: 'pointer',
                            fontSize: '16px',
                            fontWeight: 700,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            gap: '8px',
                            boxShadow: `0 4px 12px ${theme.accent}40`,
                            transition: 'transform 0.2s ease'
                        }}
                    >
                        <ShoppingCart size={24} />
                        Create Shopping List
                    </button>
                </div>
            );
        }

        // Analytics Page (Placeholder)
        function AnalyticsPage({ theme, incomes, expenses }) {
            // Calculate statistics
            const totalIncome = incomes.reduce((sum, i) => sum + i.amount, 0);
            const totalExpenses = expenses.reduce((sum, e) => sum + e.amount, 0);
            const netBalance = totalIncome - totalExpenses;

            // Category breakdown
            const categoryTotals = expenses.reduce((acc, expense) => {
                acc[expense.category] = (acc[expense.category] || 0) + expense.amount;
                return acc;
            }, {});

            const sortedCategories = Object.entries(categoryTotals)
                .sort(([, a], [, b]) => b - a)
                .slice(0, 5);

            // Source breakdown
            const sourceTotals = incomes.reduce((acc, income) => {
                acc[income.source] = (acc[income.source] || 0) + income.amount;
                return acc;
            }, {});

            return (
                <div style={{ padding: '20px' }}>
                    <h2 style={{ fontSize: '24px', fontWeight: 700, marginBottom: '20px' }}>Analytics Dashboard</h2>
                    
                    {/* Overall Stats */}
                    <div style={{
                        background: `linear-gradient(135deg, ${theme.primary}, ${theme.primaryDark})`,
                        borderRadius: '20px',
                        padding: '24px',
                        marginBottom: '20px',
                        color: theme.surface
                    }}>
                        <p style={{ margin: '0 0 8px 0', fontSize: '14px', opacity: 0.9, fontWeight: 600 }}>
                            All-Time Net Balance
                        </p>
                        <h2 style={{
                            margin: '0 0 16px 0',
                            fontSize: '36px',
                            fontWeight: 800,
                            fontFamily: "'JetBrains Mono', monospace"
                        }}>
                            KES {netBalance.toLocaleString()}
                        </h2>
                        <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '16px', fontSize: '14px' }}>
                            <div>
                                <p style={{ margin: '0 0 4px 0', opacity: 0.9 }}>Total Income</p>
                                <p style={{ margin: 0, fontSize: '20px', fontWeight: 700 }}>
                                    +{totalIncome.toLocaleString()}
                                </p>
                            </div>
                            <div>
                                <p style={{ margin: '0 0 4px 0', opacity: 0.9 }}>Total Expenses</p>
                                <p style={{ margin: 0, fontSize: '20px', fontWeight: 700 }}>
                                    -{totalExpenses.toLocaleString()}
                                </p>
                            </div>
                        </div>
                    </div>

                    {/* Quick Stats */}
                    <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '12px', marginBottom: '20px' }}>
                        <div style={{
                            background: theme.surface,
                            borderRadius: '16px',
                            padding: '20px',
                            textAlign: 'center'
                        }}>
                            <p style={{ margin: '0 0 8px 0', fontSize: '14px', color: theme.textSecondary, fontWeight: 600 }}>
                                Total Transactions
                            </p>
                            <p style={{
                                margin: 0,
                                fontSize: '32px',
                                fontWeight: 800,
                                color: theme.primary
                            }}>
                                {incomes.length + expenses.length}
                            </p>
                        </div>
                        <div style={{
                            background: theme.surface,
                            borderRadius: '16px',
                            padding: '20px',
                            textAlign: 'center'
                        }}>
                            <p style={{ margin: '0 0 8px 0', fontSize: '14px', color: theme.textSecondary, fontWeight: 600 }}>
                                Avg. Daily Expense
                            </p>
                            <p style={{
                                margin: 0,
                                fontSize: '32px',
                                fontWeight: 800,
                                color: theme.danger
                            }}>
                                {expenses.length > 0 ? Math.round(totalExpenses / expenses.length) : 0}
                            </p>
                        </div>
                    </div>

                    {/* Top Expense Categories */}
                    {sortedCategories.length > 0 && (
                        <div style={{
                            background: theme.surface,
                            borderRadius: '16px',
                            padding: '20px',
                            marginBottom: '20px'
                        }}>
                            <h3 style={{ margin: '0 0 16px 0', fontSize: '18px', fontWeight: 700 }}>
                                Top Expense Categories
                            </h3>
                            <div style={{ display: 'grid', gap: '12px' }}>
                                {sortedCategories.map(([category, amount]) => {
                                    const percentage = (amount / totalExpenses) * 100;
                                    return (
                                        <div key={category}>
                                            <div style={{
                                                display: 'flex',
                                                justifyContent: 'space-between',
                                                marginBottom: '6px'
                                            }}>
                                                <span style={{ fontWeight: 600, fontSize: '14px' }}>{category}</span>
                                                <span style={{
                                                    fontWeight: 700,
                                                    fontSize: '14px',
                                                    fontFamily: "'JetBrains Mono', monospace"
                                                }}>
                                                    KES {amount.toLocaleString()}
                                                </span>
                                            </div>
                                            <div style={{
                                                height: '8px',
                                                background: theme.background,
                                                borderRadius: '4px',
                                                overflow: 'hidden'
                                            }}>
                                                <div style={{
                                                    height: '100%',
                                                    width: `${percentage}%`,
                                                    background: theme.primary,
                                                    borderRadius: '4px',
                                                    transition: 'width 0.3s ease'
                                                }} />
                                            </div>
                                            <p style={{
                                                margin: '4px 0 0 0',
                                                fontSize: '12px',
                                                color: theme.textSecondary
                                            }}>
                                                {percentage.toFixed(1)}% of total expenses
                                            </p>
                                        </div>
                                    );
                                })}
                            </div>
                        </div>
                    )}

                    {/* Income Sources Breakdown */}
                    {Object.keys(sourceTotals).length > 0 && (
                        <div style={{
                            background: theme.surface,
                            borderRadius: '16px',
                            padding: '20px'
                        }}>
                            <h3 style={{ margin: '0 0 16px 0', fontSize: '18px', fontWeight: 700 }}>
                                Income by Source
                            </h3>
                            <div style={{ display: 'grid', gap: '12px' }}>
                                {Object.entries(sourceTotals).map(([source, amount]) => {
                                    const percentage = (amount / totalIncome) * 100;
                                    return (
                                        <div key={source} style={{
                                            padding: '16px',
                                            background: theme.background,
                                            borderRadius: '12px',
                                            display: 'flex',
                                            justifyContent: 'space-between',
                                            alignItems: 'center'
                                        }}>
                                            <div>
                                                <p style={{ margin: '0 0 4px 0', fontWeight: 600, fontSize: '16px' }}>
                                                    {source}
                                                </p>
                                                <p style={{ margin: 0, fontSize: '12px', color: theme.textSecondary }}>
                                                    {percentage.toFixed(1)}% of total income
                                                </p>
                                            </div>
                                            <p style={{
                                                margin: 0,
                                                fontSize: '20px',
                                                fontWeight: 800,
                                                color: theme.success,
                                                fontFamily: "'JetBrains Mono', monospace"
                                            }}>
                                                {amount.toLocaleString()}
                                            </p>
                                        </div>
                                    );
                                })}
                            </div>
                        </div>
                    )}

                    {incomes.length === 0 && expenses.length === 0 && (
                        <div style={{
                            textAlign: 'center',
                            padding: '40px 20px',
                            color: theme.textSecondary
                        }}>
                            <BarChart3 size={64} color={theme.primary} style={{ marginBottom: '20px' }} />
                            <p style={{ fontSize: '16px', fontWeight: 600 }}>
                                No data yet. Start tracking your income and expenses!
                            </p>
                        </div>
                    )}
                </div>
            );
        }

        // Projects Page (Placeholder)
        function ProjectsPage({ theme, projects, setProjects, activeProject, setActiveProject }) {
            const [showCreateModal, setShowCreateModal] = useState(false);
            const [showAddTransaction, setShowAddTransaction] = useState(false);

            const currentProject = projects.find(p => p.id === activeProject);

            const handleCreateProject = (projectData) => {
                const newProject = {
                    ...projectData,
                    id: Date.now(),
                    createdDate: new Date(),
                    transactions: [],
                    closed: false,
                    currentBalance: 0
                };
                setProjects([...projects, newProject]);
                setActiveProject(newProject.id);
                setShowCreateModal(false);
            };

            const handleAddTransaction = (transaction) => {
                const updatedProjects = projects.map(p => {
                    if (p.id === activeProject) {
                        const newTransactions = [...p.transactions, {
                            ...transaction,
                            id: Date.now(),
                            date: new Date()
                        }];
                        const newBalance = newTransactions.reduce((sum, t) => 
                            t.type === 'income' ? sum + t.amount : sum - t.amount, 0
                        );
                        return { ...p, transactions: newTransactions, currentBalance: newBalance };
                    }
                    return p;
                });
                setProjects(updatedProjects);
                setShowAddTransaction(false);
            };

            const handleCloseProject = () => {
                const updatedProjects = projects.map(p => {
                    if (p.id === activeProject) {
                        return { ...p, closed: true, closedDate: new Date() };
                    }
                    return p;
                });
                setProjects(updatedProjects);
            };

            if (!currentProject) {
                return (
                    <div style={{ padding: '20px' }}>
                        <div style={{ textAlign: 'center', paddingTop: '40px' }}>
                            <FolderKanban size={64} color={theme.primary} style={{ marginBottom: '20px' }} />
                            <h2 style={{ fontSize: '24px', fontWeight: 700, marginBottom: '12px' }}>My Projects</h2>
                            <p style={{ color: theme.textSecondary, marginBottom: '24px' }}>
                                Track savings goals, business ventures, and farming projects
                            </p>

                            <button
                                onClick={() => setShowCreateModal(true)}
                                style={{
                                    background: `linear-gradient(135deg, ${theme.primary}, ${theme.primaryDark})`,
                                    color: theme.surface,
                                    border: 'none',
                                    borderRadius: '16px',
                                    padding: '16px 32px',
                                    fontSize: '16px',
                                    fontWeight: 700,
                                    cursor: 'pointer',
                                    display: 'inline-flex',
                                    alignItems: 'center',
                                    gap: '8px',
                                    boxShadow: `0 4px 12px ${theme.primary}40`
                                }}
                            >
                                <Plus size={20} />
                                Create New Project
                            </button>
                        </div>

                        {projects.length > 0 && (
                            <div style={{ marginTop: '40px' }}>
                                <h3 style={{ fontSize: '18px', fontWeight: 700, marginBottom: '16px' }}>All Projects</h3>
                                <div style={{ display: 'grid', gap: '12px' }}>
                                    {projects.map(project => (
                                        <div
                                            key={project.id}
                                            onClick={() => setActiveProject(project.id)}
                                            style={{
                                                background: theme.surface,
                                                borderRadius: '16px',
                                                padding: '20px',
                                                cursor: 'pointer',
                                                border: `2px solid ${theme.border}`,
                                                transition: 'all 0.2s ease'
                                            }}
                                        >
                                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '12px' }}>
                                                <div>
                                                    <h4 style={{ margin: '0 0 4px 0', fontSize: '18px', fontWeight: 700 }}>
                                                        {project.name}
                                                    </h4>
                                                    <p style={{ margin: 0, fontSize: '14px', color: theme.textSecondary }}>
                                                        {project.type}
                                                    </p>
                                                </div>
                                                {project.closed && (
                                                    <span style={{
                                                        background: theme.textSecondary,
                                                        color: theme.surface,
                                                        padding: '4px 12px',
                                                        borderRadius: '8px',
                                                        fontSize: '12px',
                                                        fontWeight: 700
                                                    }}>CLOSED</span>
                                                )}
                                            </div>
                                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                                                <div>
                                                    <p style={{ margin: '0 0 4px 0', fontSize: '12px', color: theme.textSecondary }}>
                                                        Current Balance
                                                    </p>
                                                    <p style={{
                                                        margin: 0,
                                                        fontSize: '24px',
                                                        fontWeight: 800,
                                                        color: project.currentBalance >= 0 ? theme.success : theme.danger,
                                                        fontFamily: "'JetBrains Mono', monospace"
                                                    }}>
                                                        KES {project.currentBalance.toLocaleString()}
                                                    </p>
                                                </div>
                                                {project.targetAmount && (
                                                    <div style={{ textAlign: 'right' }}>
                                                        <p style={{ margin: '0 0 4px 0', fontSize: '12px', color: theme.textSecondary }}>
                                                            Target
                                                        </p>
                                                        <p style={{ margin: 0, fontSize: '16px', fontWeight: 700 }}>
                                                            KES {project.targetAmount.toLocaleString()}
                                                        </p>
                                                    </div>
                                                )}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {showCreateModal && (
                            <CreateProjectModal
                                theme={theme}
                                onClose={() => setShowCreateModal(false)}
                                onCreate={handleCreateProject}
                            />
                        )}
                    </div>
                );
            }

            const profitLoss = currentProject.currentBalance - (currentProject.targetAmount || 0);

            return (
                <div style={{ padding: '20px' }}>
                    <div style={{
                        display: 'flex',
                        justifyContent: 'space-between',
                        alignItems: 'center',
                        marginBottom: '20px'
                    }}>
                        <button
                            onClick={() => setActiveProject(null)}
                            style={{
                                background: 'none',
                                border: 'none',
                                color: theme.primary,
                                fontSize: '16px',
                                fontWeight: 700,
                                cursor: 'pointer',
                                display: 'flex',
                                alignItems: 'center',
                                gap: '4px'
                            }}
                        >
                            ← Back
                        </button>
                        
                        {!currentProject.closed && (
                            <button
                                onClick={handleCloseProject}
                                style={{
                                    background: theme.danger,
                                    color: theme.surface,
                                    border: 'none',
                                    borderRadius: '12px',
                                    padding: '8px 16px',
                                    fontSize: '14px',
                                    fontWeight: 700,
                                    cursor: 'pointer'
                                }}
                            >
                                Close Project
                            </button>
                        )}
                    </div>

                    <div style={{
                        background: `linear-gradient(135deg, ${theme.primary}, ${theme.primaryDark})`,
                        borderRadius: '20px',
                        padding: '24px',
                        marginBottom: '20px',
                        color: theme.surface
                    }}>
                        <div style={{ marginBottom: '16px' }}>
                            <h2 style={{ margin: '0 0 4px 0', fontSize: '24px', fontWeight: 800 }}>
                                {currentProject.name}
                            </h2>
                            <p style={{ margin: 0, fontSize: '14px', opacity: 0.9 }}>
                                {currentProject.type}
                            </p>
                        </div>
                        
                        <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '16px' }}>
                            <div>
                                <p style={{ margin: '0 0 4px 0', fontSize: '12px', opacity: 0.9 }}>Current Balance</p>
                                <p style={{
                                    margin: 0,
                                    fontSize: '28px',
                                    fontWeight: 800,
                                    fontFamily: "'JetBrains Mono', monospace"
                                }}>
                                    KES {currentProject.currentBalance.toLocaleString()}
                                </p>
                            </div>
                            {currentProject.targetAmount && (
                                <div>
                                    <p style={{ margin: '0 0 4px 0', fontSize: '12px', opacity: 0.9 }}>Target Amount</p>
                                    <p style={{
                                        margin: 0,
                                        fontSize: '28px',
                                        fontWeight: 800,
                                        fontFamily: "'JetBrains Mono', monospace"
                                    }}>
                                        KES {currentProject.targetAmount.toLocaleString()}
                                    </p>
                                </div>
                            )}
                        </div>

                        {currentProject.closed && (
                            <div style={{
                                marginTop: '16px',
                                padding: '16px',
                                background: 'rgba(255,255,255,0.2)',
                                borderRadius: '12px'
                            }}>
                                <p style={{ margin: '0 0 8px 0', fontSize: '14px', fontWeight: 600 }}>
                                    Project Closed
                                </p>
                                <p style={{
                                    margin: 0,
                                    fontSize: '20px',
                                    fontWeight: 800,
                                    fontFamily: "'JetBrains Mono', monospace"
                                }}>
                                    {profitLoss >= 0 ? 'PROFIT' : 'LOSS'}: KES {Math.abs(profitLoss).toLocaleString()}
                                </p>
                            </div>
                        )}
                    </div>

                    {!currentProject.closed && (
                        <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '12px', marginBottom: '20px' }}>
                            <button
                                onClick={() => setShowAddTransaction('income')}
                                style={{
                                    background: theme.success,
                                    color: 'white',
                                    border: 'none',
                                    borderRadius: '12px',
                                    padding: '16px',
                                    fontSize: '16px',
                                    fontWeight: 700,
                                    cursor: 'pointer',
                                    display: 'flex',
                                    alignItems: 'center',
                                    justifyContent: 'center',
                                    gap: '8px'
                                }}
                            >
                                <Plus size={20} />
                                Add Income
                            </button>
                            <button
                                onClick={() => setShowAddTransaction('expense')}
                                style={{
                                    background: theme.danger,
                                    color: 'white',
                                    border: 'none',
                                    borderRadius: '12px',
                                    padding: '16px',
                                    fontSize: '16px',
                                    fontWeight: 700,
                                    cursor: 'pointer',
                                    display: 'flex',
                                    alignItems: 'center',
                                    justifyContent: 'center',
                                    gap: '8px'
                                }}
                            >
                                <Plus size={20} />
                                Add Expense
                            </button>
                        </div>
                    )}

                    <div style={{
                        background: theme.surface,
                        borderRadius: '16px',
                        padding: '20px'
                    }}>
                        <h3 style={{ margin: '0 0 16px 0', fontSize: '18px', fontWeight: 700 }}>
                            Transaction History
                        </h3>

                        {currentProject.transactions.length === 0 ? (
                            <p style={{ textAlign: 'center', color: theme.textSecondary, padding: '20px 0' }}>
                                No transactions yet
                            </p>
                        ) : (
                            <div style={{ display: 'grid', gap: '8px' }}>
                                {currentProject.transactions.map(transaction => (
                                    <div key={transaction.id} style={{
                                        padding: '16px',
                                        background: theme.background,
                                        borderRadius: '12px',
                                        display: 'flex',
                                        justifyContent: 'space-between',
                                        alignItems: 'center'
                                    }}>
                                        <div>
                                            <p style={{ margin: '0 0 4px 0', fontSize: '16px', fontWeight: 600 }}>
                                                {transaction.description}
                                            </p>
                                            <p style={{ margin: 0, fontSize: '12px', color: theme.textSecondary }}>
                                                {new Date(transaction.date).toLocaleDateString()}
                                            </p>
                                        </div>
                                        <div style={{ textAlign: 'right' }}>
                                            <p style={{
                                                margin: 0,
                                                fontSize: '18px',
                                                fontWeight: 700,
                                                color: transaction.type === 'income' ? theme.success : theme.danger,
                                                fontFamily: "'JetBrains Mono', monospace"
                                            }}>
                                                {transaction.type === 'income' ? '+' : '-'} KES {transaction.amount.toLocaleString()}
                                            </p>
                                        </div>
                                    </div>
                                ))}
                                
                                <div style={{
                                    marginTop: '8px',
                                    padding: '16px',
                                    background: theme.primary,
                                    borderRadius: '12px',
                                    color: theme.surface
                                }}>
                                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                                        <span style={{ fontSize: '16px', fontWeight: 700 }}>Total Balance</span>
                                        <span style={{
                                            fontSize: '24px',
                                            fontWeight: 800,
                                            fontFamily: "'JetBrains Mono', monospace"
                                        }}>
                                            KES {currentProject.currentBalance.toLocaleString()}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>

                    {showAddTransaction && (
                        <AddProjectTransactionModal
                            theme={theme}
                            type={showAddTransaction}
                            onClose={() => setShowAddTransaction(false)}
                            onSave={handleAddTransaction}
                        />
                    )}
                </div>
            );
        }

        // Shopping Page
        function ShoppingPage({ theme, shoppingLists, setShoppingLists, activeShoppingList, setActiveShoppingList, onAddToExpenses }) {
            const [showCreateModal, setShowCreateModal] = useState(false);
            const [newItem, setNewItem] = useState({ name: '', quantity: 1, unitPrice: '' });

            const currentList = shoppingLists.find(l => l.id === activeShoppingList);

            const handleAddItem = () => {
                if (newItem.name && newItem.unitPrice) {
                    const updatedLists = shoppingLists.map(list => {
                        if (list.id === activeShoppingList) {
                            return {
                                ...list,
                                items: [...list.items, {
                                    ...newItem,
                                    id: Date.now(),
                                    unitPrice: parseFloat(newItem.unitPrice),
                                    purchased: false
                                }]
                            };
                        }
                        return list;
                    });
                    setShoppingLists(updatedLists);
                    setNewItem({ name: '', quantity: 1, unitPrice: '' });
                }
            };

            const handleTogglePurchased = (itemId) => {
                const updatedLists = shoppingLists.map(list => {
                    if (list.id === activeShoppingList) {
                        return {
                            ...list,
                            items: list.items.map(item =>
                                item.id === itemId ? { ...item, purchased: !item.purchased } : item
                            )
                        };
                    }
                    return list;
                });
                setShoppingLists(updatedLists);
            };

            const handleCompleteList = () => {
                const list = shoppingLists.find(l => l.id === activeShoppingList);
                if (list) {
                    const purchasedItems = list.items.filter(i => i.purchased);
                    const total = purchasedItems.reduce((sum, item) => sum + (item.quantity * item.unitPrice), 0);
                    onAddToExpenses(purchasedItems, total);
                    
                    const updatedLists = shoppingLists.map(l =>
                        l.id === activeShoppingList ? { ...l, completed: true, completedDate: new Date() } : l
                    );
                    setShoppingLists(updatedLists);
                    setActiveShoppingList(null);
                }
            };

            const handleDeleteItem = (itemId) => {
                const updatedLists = shoppingLists.map(list => {
                    if (list.id === activeShoppingList) {
                        return {
                            ...list,
                            items: list.items.filter(item => item.id !== itemId)
                        };
                    }
                    return list;
                });
                setShoppingLists(updatedLists);
            };

            if (!currentList) {
                return (
                    <div style={{ padding: '20px' }}>
                        <div style={{ textAlign: 'center', paddingTop: '40px' }}>
                            <ShoppingCart size={64} color={theme.primary} style={{ marginBottom: '20px' }} />
                            <h2 style={{ fontSize: '24px', fontWeight: 700, marginBottom: '12px' }}>Shopping Lists</h2>
                            <p style={{ color: theme.textSecondary, marginBottom: '24px' }}>
                                Plan your shopping and track actual spending
                            </p>

                            <button
                                onClick={() => setShowCreateModal(true)}
                                style={{
                                    background: `linear-gradient(135deg, ${theme.primary}, ${theme.primaryDark})`,
                                    color: theme.surface,
                                    border: 'none',
                                    borderRadius: '16px',
                                    padding: '16px 32px',
                                    fontSize: '16px',
                                    fontWeight: 700,
                                    cursor: 'pointer',
                                    display: 'inline-flex',
                                    alignItems: 'center',
                                    gap: '8px',
                                    boxShadow: `0 4px 12px ${theme.primary}40`
                                }}
                            >
                                <Plus size={20} />
                                Create Shopping List
                            </button>
                        </div>

                        {shoppingLists.length > 0 && (
                            <div style={{ marginTop: '40px' }}>
                                <h3 style={{ fontSize: '18px', fontWeight: 700, marginBottom: '16px' }}>My Lists</h3>
                                <div style={{ display: 'grid', gap: '12px' }}>
                                    {shoppingLists.map(list => {
                                        const total = list.items.reduce((sum, item) => 
                                            sum + (item.quantity * item.unitPrice), 0
                                        );
                                        return (
                                            <div
                                                key={list.id}
                                                onClick={() => setActiveShoppingList(list.id)}
                                                style={{
                                                    background: theme.surface,
                                                    borderRadius: '16px',
                                                    padding: '20px',
                                                    cursor: 'pointer',
                                                    border: `2px solid ${theme.border}`,
                                                    transition: 'all 0.2s ease'
                                                }}
                                            >
                                                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '12px' }}>
                                                    <div>
                                                        <h4 style={{ margin: '0 0 4px 0', fontSize: '18px', fontWeight: 700 }}>
                                                            {list.name}
                                                        </h4>
                                                        <p style={{ margin: 0, fontSize: '14px', color: theme.textSecondary }}>
                                                            {list.items.length} items
                                                        </p>
                                                    </div>
                                                    {list.completed && (
                                                        <span style={{
                                                            background: theme.success,
                                                            color: theme.surface,
                                                            padding: '4px 12px',
                                                            borderRadius: '8px',
                                                            fontSize: '12px',
                                                            fontWeight: 700
                                                        }}>COMPLETED</span>
                                                    )}
                                                </div>
                                                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                                                    <p style={{ margin: 0, fontSize: '12px', color: theme.textSecondary }}>
                                                        Estimated Total
                                                    </p>
                                                    <p style={{
                                                        margin: 0,
                                                        fontSize: '24px',
                                                        fontWeight: 800,
                                                        color: theme.primary,
                                                        fontFamily: "'JetBrains Mono', monospace"
                                                    }}>
                                                        KES {total.toLocaleString()}
                                                    </p>
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        )}

                        {showCreateModal && (
                            <CreateShoppingListModal
                                theme={theme}
                                onClose={() => setShowCreateModal(false)}
                                onCreate={(list) => {
                                    const newList = {
                                        ...list,
                                        id: Date.now(),
                                        createdDate: new Date(),
                                        items: [],
                                        completed: false
                                    };
                                    setShoppingLists([...shoppingLists, newList]);
                                    setActiveShoppingList(newList.id);
                                    setShowCreateModal(false);
                                }}
                            />
                        )}
                    </div>
                );
            }

            const total = currentList.items.reduce((sum, item) => sum + (item.quantity * item.unitPrice), 0);
            const purchasedTotal = currentList.items
                .filter(i => i.purchased)
                .reduce((sum, item) => sum + (item.quantity * item.unitPrice), 0);

            return (
                <div style={{ padding: '20px' }}>
                    <div style={{
                        display: 'flex',
                        justifyContent: 'space-between',
                        alignItems: 'center',
                        marginBottom: '20px'
                    }}>
                        <button
                            onClick={() => setActiveShoppingList(null)}
                            style={{
                                background: 'none',
                                border: 'none',
                                color: theme.primary,
                                fontSize: '16px',
                                fontWeight: 700,
                                cursor: 'pointer',
                                display: 'flex',
                                alignItems: 'center',
                                gap: '4px'
                            }}
                        >
                            ← Back
                        </button>
                    </div>

                    <div style={{
                        background: `linear-gradient(135deg, ${theme.primary}, ${theme.primaryDark})`,
                        borderRadius: '20px',
                        padding: '24px',
                        marginBottom: '20px',
                        color: theme.surface
                    }}>
                        <h2 style={{ margin: '0 0 4px 0', fontSize: '24px', fontWeight: 800 }}>
                            {currentList.name}
                        </h2>
                        <p style={{ margin: '0 0 16px 0', fontSize: '14px', opacity: 0.9 }}>
                            {currentList.items.length} items
                        </p>
                        
                        <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '16px' }}>
                            <div>
                                <p style={{ margin: '0 0 4px 0', fontSize: '12px', opacity: 0.9 }}>Estimated Total</p>
                                <p style={{
                                    margin: 0,
                                    fontSize: '28px',
                                    fontWeight: 800,
                                    fontFamily: "'JetBrains Mono', monospace"
                                }}>
                                    KES {total.toLocaleString()}
                                </p>
                            </div>
                            <div>
                                <p style={{ margin: '0 0 4px 0', fontSize: '12px', opacity: 0.9 }}>Purchased</p>
                                <p style={{
                                    margin: 0,
                                    fontSize: '28px',
                                    fontWeight: 800,
                                    fontFamily: "'JetBrains Mono', monospace"
                                }}>
                                    KES {purchasedTotal.toLocaleString()}
                                </p>
                            </div>
                        </div>
                    </div>

                    {!currentList.completed && (
                        <div style={{
                            background: theme.surface,
                            borderRadius: '16px',
                            padding: '20px',
                            marginBottom: '20px'
                        }}>
                            <h3 style={{ margin: '0 0 16px 0', fontSize: '16px', fontWeight: 700 }}>Add New Item</h3>
                            <div style={{ display: 'grid', gap: '12px' }}>
                                <input
                                    type="text"
                                    placeholder="Item name"
                                    value={newItem.name}
                                    onChange={(e) => setNewItem({ ...newItem, name: e.target.value })}
                                    style={{
                                        padding: '12px',
                                        borderRadius: '12px',
                                        border: `2px solid ${theme.border}`,
                                        background: theme.background,
                                        fontSize: '16px',
                                        fontWeight: 600
                                    }}
                                />
                                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '12px' }}>
                                    <input
                                        type="number"
                                        placeholder="Qty"
                                        value={newItem.quantity}
                                        onChange={(e) => setNewItem({ ...newItem, quantity: parseInt(e.target.value) || 1 })}
                                        style={{
                                            padding: '12px',
                                            borderRadius: '12px',
                                            border: `2px solid ${theme.border}`,
                                            background: theme.background,
                                            fontSize: '16px',
                                            fontWeight: 600
                                        }}
                                    />
                                    <input
                                        type="number"
                                        placeholder="Unit Price"
                                        value={newItem.unitPrice}
                                        onChange={(e) => setNewItem({ ...newItem, unitPrice: e.target.value })}
                                        style={{
                                            padding: '12px',
                                            borderRadius: '12px',
                                            border: `2px solid ${theme.border}`,
                                            background: theme.background,
                                            fontSize: '16px',
                                            fontWeight: 600
                                        }}
                                    />
                                </div>
                                <button
                                    onClick={handleAddItem}
                                    style={{
                                        background: theme.primary,
                                        color: theme.surface,
                                        border: 'none',
                                        borderRadius: '12px',
                                        padding: '12px',
                                        fontSize: '16px',
                                        fontWeight: 700,
                                        cursor: 'pointer',
                                        display: 'flex',
                                        alignItems: 'center',
                                        justifyContent: 'center',
                                        gap: '8px'
                                    }}
                                >
                                    <Plus size={20} />
                                    Add Item
                                </button>
                            </div>
                        </div>
                    )}

                    <div style={{
                        background: theme.surface,
                        borderRadius: '16px',
                        padding: '20px'
                    }}>
                        <h3 style={{ margin: '0 0 16px 0', fontSize: '18px', fontWeight: 700 }}>Items</h3>

                        {currentList.items.length === 0 ? (
                            <p style={{ textAlign: 'center', color: theme.textSecondary, padding: '20px 0' }}>
                                No items yet. Add some items above!
                            </p>
                        ) : (
                            <div>
                                <div style={{
                                    display: 'grid',
                                    gridTemplateColumns: '2fr 1fr 1fr 1fr auto',
                                    gap: '12px',
                                    padding: '12px',
                                    background: theme.background,
                                    borderRadius: '12px',
                                    marginBottom: '12px',
                                    fontSize: '12px',
                                    fontWeight: 700,
                                    color: theme.textSecondary
                                }}>
                                    <div>ITEM</div>
                                    <div>QTY</div>
                                    <div>PRICE</div>
                                    <div>SUBTOTAL</div>
                                    <div></div>
                                </div>
                                {currentList.items.map(item => {
                                    const subtotal = item.quantity * item.unitPrice;
                                    return (
                                        <div key={item.id} style={{
                                            display: 'grid',
                                            gridTemplateColumns: '2fr 1fr 1fr 1fr auto',
                                            gap: '12px',
                                            padding: '16px 12px',
                                            borderBottom: `1px solid ${theme.border}`,
                                            alignItems: 'center',
                                            opacity: item.purchased ? 0.6 : 1,
                                            textDecoration: item.purchased ? 'line-through' : 'none'
                                        }}>
                                            <div style={{
                                                display: 'flex',
                                                alignItems: 'center',
                                                gap: '8px'
                                            }}>
                                                {!currentList.completed && (
                                                    <input
                                                        type="checkbox"
                                                        checked={item.purchased}
                                                        onChange={() => handleTogglePurchased(item.id)}
                                                        style={{ width: '18px', height: '18px', cursor: 'pointer' }}
                                                    />
                                                )}
                                                <span style={{ fontWeight: 600 }}>{item.name}</span>
                                            </div>
                                            <div>{item.quantity}</div>
                                            <div style={{ fontFamily: "'JetBrains Mono', monospace" }}>
                                                {item.unitPrice.toLocaleString()}
                                            </div>
                                            <div style={{
                                                fontWeight: 700,
                                                fontFamily: "'JetBrains Mono', monospace"
                                            }}>
                                                {subtotal.toLocaleString()}
                                            </div>
                                            {!currentList.completed && (
                                                <button
                                                    onClick={() => handleDeleteItem(item.id)}
                                                    style={{
                                                        background: 'none',
                                                        border: 'none',
                                                        cursor: 'pointer',
                                                        padding: '4px'
                                                    }}
                                                >
                                                    <Trash2 size={18} color={theme.danger} />
                                                </button>
                                            )}
                                        </div>
                                    );
                                })}
                                
                                <div style={{
                                    display: 'grid',
                                    gridTemplateColumns: '2fr 1fr 1fr 1fr auto',
                                    gap: '12px',
                                    padding: '16px 12px',
                                    background: theme.primary,
                                    borderRadius: '12px',
                                    marginTop: '12px',
                                    color: theme.surface,
                                    fontWeight: 700
                                }}>
                                    <div>TOTAL</div>
                                    <div></div>
                                    <div></div>
                                    <div style={{
                                        fontSize: '20px',
                                        fontFamily: "'JetBrains Mono', monospace"
                                    }}>
                                        {total.toLocaleString()}
                                    </div>
                                    <div></div>
                                </div>
                            </div>
                        )}
                    </div>

                    {!currentList.completed && currentList.items.length > 0 && (
                        <button
                            onClick={handleCompleteList}
                            style={{
                                width: '100%',
                                background: theme.success,
                                color: 'white',
                                border: 'none',
                                borderRadius: '16px',
                                padding: '16px',
                                fontSize: '16px',
                                fontWeight: 700,
                                cursor: 'pointer',
                                marginTop: '20px',
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                gap: '8px'
                            }}
                        >
                            <CheckCircle2 size={20} />
                            Complete Shopping & Add to Expenses
                        </button>
                    )}
                </div>
            );
        }

        // Settings Page (Placeholder)
        function SettingsPage({ theme, categories, setCategories }) {
            return (
                <div style={{ padding: '20px' }}>
                    <h2 style={{ fontSize: '20px', fontWeight: 700, marginBottom: '20px' }}>Settings</h2>
                    
                    <div style={{
                        background: theme.surface,
                        borderRadius: '16px',
                        padding: '20px',
                        marginBottom: '20px'
                    }}>
                        <h3 style={{ fontSize: '16px', fontWeight: 700, marginBottom: '12px' }}>Expense Categories</h3>
                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '8px' }}>
                            {categories.map(cat => (
                                <span key={cat} style={{
                                    background: theme.background,
                                    color: theme.text,
                                    padding: '8px 16px',
                                    borderRadius: '20px',
                                    fontSize: '14px',
                                    fontWeight: 600
                                }}>
                                    {cat}
                                </span>
                            ))}
                        </div>
                    </div>

                    <div style={{
                        background: theme.surface,
                        borderRadius: '16px',
                        padding: '20px'
                    }}>
                        <h3 style={{ fontSize: '16px', fontWeight: 700, marginBottom: '12px' }}>M-PESA Auto-Parsing</h3>
                        <p style={{ fontSize: '14px', color: theme.textSecondary, marginBottom: '12px' }}>
                            Automatically detect and categorize M-PESA transactions
                        </p>
                        <label style={{ display: 'flex', alignItems: 'center', gap: '12px', cursor: 'pointer' }}>
                            <input type="checkbox" defaultChecked style={{ width: '20px', height: '20px' }} />
                            <span style={{ fontSize: '14px', fontWeight: 600 }}>Enable Smart Prompts</span>
                        </label>
                    </div>
                </div>
            );
        }

        // Theme Selector Component
        function ThemeSelector({ currentTheme, onChange, theme }) {
            const [showPicker, setShowPicker] = useState(false);

            return (
                <div style={{ position: 'relative' }}>
                    <button
                        onClick={() => setShowPicker(!showPicker)}
                        style={{
                            background: theme.primary,
                            border: 'none',
                            borderRadius: '12px',
                            padding: '8px 12px',
                            cursor: 'pointer',
                            color: theme.surface,
                            fontSize: '14px',
                            fontWeight: 600,
                            display: 'flex',
                            alignItems: 'center',
                            gap: '6px'
                        }}
                    >
                        <div style={{
                            width: '16px',
                            height: '16px',
                            borderRadius: '50%',
                            background: theme.primary
                        }} />
                        Theme
                    </button>

                    {showPicker && (
                        <div style={{
                            position: 'absolute',
                            top: '100%',
                            right: 0,
                            marginTop: '8px',
                            background: theme.surface,
                            borderRadius: '12px',
                            padding: '12px',
                            boxShadow: '0 4px 20px rgba(0,0,0,0.15)',
                            zIndex: 100,
                            minWidth: '160px'
                        }}>
                            {Object.entries(THEMES).map(([key, t]) => (
                                <button
                                    key={key}
                                    onClick={() => {
                                        onChange(key);
                                        setShowPicker(false);
                                    }}
                                    style={{
                                        width: '100%',
                                        background: currentTheme === key ? theme.background : 'transparent',
                                        border: 'none',
                                        borderRadius: '8px',
                                        padding: '10px 12px',
                                        cursor: 'pointer',
                                        display: 'flex',
                                        alignItems: 'center',
                                        gap: '10px',
                                        marginBottom: '4px',
                                        textAlign: 'left'
                                    }}
                                >
                                    <div style={{
                                        width: '20px',
                                        height: '20px',
                                        borderRadius: '50%',
                                        background: t.primary
                                    }} />
                                    <span style={{
                                        fontSize: '14px',
                                        fontWeight: currentTheme === key ? 700 : 500,
                                        color: theme.text
                                    }}>{t.name}</span>
                                </button>
                            ))}
                        </div>
                    )}
                </div>
            );
        }

        // Add Income Modal
        function AddIncomeModal({ theme, onClose, onSave }) {
            const [source, setSource] = useState('M-PESA');
            const [amount, setAmount] = useState('');
            const [description, setDescription] = useState('');

            const handleSave = () => {
                if (amount && parseFloat(amount) > 0) {
                    onSave({ source, amount: parseFloat(amount), description });
                }
            };

            return (
                <div style={{
                    position: 'fixed',
                    top: 0,
                    left: 0,
                    right: 0,
                    bottom: 0,
                    background: 'rgba(0,0,0,0.5)',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    zIndex: 1000,
                    padding: '20px'
                }}>
                    <div style={{
                        background: theme.surface,
                        borderRadius: '20px',
                        padding: '24px',
                        maxWidth: '400px',
                        width: '100%'
                    }}>
                        <h3 style={{ margin: '0 0 20px 0', fontSize: '20px', fontWeight: 700 }}>Add Income</h3>
                        
                        <div style={{ marginBottom: '16px' }}>
                            <label style={{ display: 'block', marginBottom: '8px', fontSize: '14px', fontWeight: 600 }}>
                                Source
                            </label>
                            <select
                                value={source}
                                onChange={(e) => setSource(e.target.value)}
                                style={{
                                    width: '100%',
                                    padding: '12px',
                                    borderRadius: '12px',
                                    border: `2px solid ${theme.border}`,
                                    background: theme.background,
                                    fontSize: '16px',
                                    fontWeight: 600
                                }}
                            >
                                <option value="Bank">Bank</option>
                                <option value="M-PESA">M-PESA</option>
                                <option value="Cash">Cash</option>
                            </select>
                        </div>

                        <div style={{ marginBottom: '16px' }}>
                            <label style={{ display: 'block', marginBottom: '8px', fontSize: '14px', fontWeight: 600 }}>
                                Amount (KES)
                            </label>
                            <input
                                type="number"
                                value={amount}
                                onChange={(e) => setAmount(e.target.value)}
                                placeholder="0.00"
                                style={{
                                    width: '100%',
                                    padding: '12px',
                                    borderRadius: '12px',
                                    border: `2px solid ${theme.border}`,
                                    background: theme.background,
                                    fontSize: '16px',
                                    fontWeight: 600
                                }}
                            />
                        </div>

                        <div style={{ marginBottom: '20px' }}>
                            <label style={{ display: 'block', marginBottom: '8px', fontSize: '14px', fontWeight: 600 }}>
                                Description
                            </label>
                            <input
                                type="text"
                                value={description}
                                onChange={(e) => setDescription(e.target.value)}
                                placeholder="e.g., Salary, Freelance work"
                                style={{
                                    width: '100%',
                                    padding: '12px',
                                    borderRadius: '12px',
                                    border: `2px solid ${theme.border}`,
                                    background: theme.background,
                                    fontSize: '16px'
                                }}
                            />
                        </div>

                        <div style={{ display: 'flex', gap: '12px' }}>
                            <button
                                onClick={onClose}
                                style={{
                                    flex: 1,
                                    padding: '14px',
                                    borderRadius: '12px',
                                    border: `2px solid ${theme.border}`,
                                    background: 'transparent',
                                    fontSize: '16px',
                                    fontWeight: 700,
                                    cursor: 'pointer'
                                }}
                            >
                                Cancel
                            </button>
                            <button
                                onClick={handleSave}
                                style={{
                                    flex: 1,
                                    padding: '14px',
                                    borderRadius: '12px',
                                    border: 'none',
                                    background: theme.success,
                                    color: 'white',
                                    fontSize: '16px',
                                    fontWeight: 700,
                                    cursor: 'pointer'
                                }}
                            >
                                Save Income
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        // Add Expense Modal
        function AddExpenseModal({ theme, categories, onClose, onSave }) {
            const [category, setCategory] = useState(categories[0]);
            const [amount, setAmount] = useState('');
            const [description, setDescription] = useState('');

            const handleSave = () => {
                if (amount && parseFloat(amount) > 0) {
                    onSave({ category, amount: parseFloat(amount), description, source: 'Manual' });
                }
            };

            return (
                <div style={{
                    position: 'fixed',
                    top: 0,
                    left: 0,
                    right: 0,
                    bottom: 0,
                    background: 'rgba(0,0,0,0.5)',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    zIndex: 1000,
                    padding: '20px'
                }}>
                    <div style={{
                        background: theme.surface,
                        borderRadius: '20px',
                        padding: '24px',
                        maxWidth: '400px',
                        width: '100%'
                    }}>
                        <h3 style={{ margin: '0 0 20px 0', fontSize: '20px', fontWeight: 700 }}>Add Expense</h3>
                        
                        <div style={{ marginBottom: '16px' }}>
                            <label style={{ display: 'block', marginBottom: '8px', fontSize: '14px', fontWeight: 600 }}>
                                Category
                            </label>
                            <select
                                value={category}
                                onChange={(e) => setCategory(e.target.value)}
                                style={{
                                    width: '100%',
                                    padding: '12px',
                                    borderRadius: '12px',
                                    border: `2px solid ${theme.border}`,
                                    background: theme.background,
                                    fontSize: '16px',
                                    fontWeight: 600
                                }}
                            >
                                {categories.map(cat => (
                                    <option key={cat} value={cat}>{cat}</option>
                                ))}
                            </select>
                        </div>

                        <div style={{ marginBottom: '16px' }}>
                            <label style={{ display: 'block', marginBottom: '8px', fontSize: '14px', fontWeight: 600 }}>
                                Amount (KES)
                            </label>
                            <input
                                type="number"
                                value={amount}
                                onChange={(e) => setAmount(e.target.value)}
                                placeholder="0.00"
                                style={{
                                    width: '100%',
                                    padding: '12px',
                                    borderRadius: '12px',
                                    border: `2px solid ${theme.border}`,
                                    background: theme.background,
                                    fontSize: '16px',
                                    fontWeight: 600
                                }}
                            />
                        </div>

                        <div style={{ marginBottom: '20px' }}>
                            <label style={{ display: 'block', marginBottom: '8px', fontSize: '14px', fontWeight: 600 }}>
                                Description
                            </label>
                            <input
                                type="text"
                                value={description}
                                onChange={(e) => setDescription(e.target.value)}
                                placeholder="e.g., Groceries, Uber ride"
                                style={{
                                    width: '100%',
                                    padding: '12px',
                                    borderRadius: '12px',
                                    border: `2px solid ${theme.border}`,
                                    background: theme.background,
                                    fontSize: '16px'
                                }}
                            />
                        </div>

                        <div style={{ display: 'flex', gap: '12px' }}>
                            <button
                                onClick={onClose}
                                style={{
                                    flex: 1,
                                    padding: '14px',
                                    borderRadius: '12px',
                                    border: `2px solid ${theme.border}`,
                                    background: 'transparent',
                                    fontSize: '16px',
                                    fontWeight: 700,
                                    cursor: 'pointer'
                                }}
                            >
                                Cancel
                            </button>
                            <button
                                onClick={handleSave}
                                style={{
                                    flex: 1,
                                    padding: '14px',
                                    borderRadius: '12px',
                                    border: 'none',
                                    background: theme.danger,
                                    color: 'white',
                                    fontSize: '16px',
                                    fontWeight: 700,
                                    cursor: 'pointer'
                                }}
                            >
                                Save Expense
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        // Create Shopping List Modal
        function CreateShoppingListModal({ theme, onClose, onCreate }) {
            const [name, setName] = useState('');

            const handleCreate = () => {
                if (name.trim()) {
                    onCreate({ name });
                }
            };

            return (
                <div style={{
                    position: 'fixed',
                    top: 0,
                    left: 0,
                    right: 0,
                    bottom: 0,
                    background: 'rgba(0,0,0,0.5)',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    zIndex: 1000,
                    padding: '20px'
                }}>
                    <div style={{
                        background: theme.surface,
                        borderRadius: '20px',
                        padding: '24px',
                        maxWidth: '400px',
                        width: '100%'
                    }}>
                        <h3 style={{ margin: '0 0 20px 0', fontSize: '20px', fontWeight: 700 }}>Create Shopping List</h3>
                        
                        <div style={{ marginBottom: '20px' }}>
                            <label style={{ display: 'block', marginBottom: '8px', fontSize: '14px', fontWeight: 600 }}>
                                List Name
                            </label>
                            <input
                                type="text"
                                value={name}
                                onChange={(e) => setName(e.target.value)}
                                placeholder="e.g., Weekly Groceries, Party Shopping"
                                style={{
                                    width: '100%',
                                    padding: '12px',
                                    borderRadius: '12px',
                                    border: `2px solid ${theme.border}`,
                                    background: theme.background,
                                    fontSize: '16px',
                                    fontWeight: 600
                                }}
                            />
                        </div>

                        <div style={{ display: 'flex', gap: '12px' }}>
                            <button
                                onClick={onClose}
                                style={{
                                    flex: 1,
                                    padding: '14px',
                                    borderRadius: '12px',
                                    border: `2px solid ${theme.border}`,
                                    background: 'transparent',
                                    fontSize: '16px',
                                    fontWeight: 700,
                                    cursor: 'pointer'
                                }}
                            >
                                Cancel
                            </button>
                            <button
                                onClick={handleCreate}
                                style={{
                                    flex: 1,
                                    padding: '14px',
                                    borderRadius: '12px',
                                    border: 'none',
                                    background: theme.primary,
                                    color: 'white',
                                    fontSize: '16px',
                                    fontWeight: 700,
                                    cursor: 'pointer'
                                }}
                            >
                                Create List
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        // Create Project Modal
        function CreateProjectModal({ theme, onClose, onCreate }) {
            const [name, setName] = useState('');
            const [type, setType] = useState('Savings Goal');
            const [targetAmount, setTargetAmount] = useState('');

            const handleCreate = () => {
                if (name.trim()) {
                    onCreate({
                        name,
                        type,
                        targetAmount: targetAmount ? parseFloat(targetAmount) : null
                    });
                }
            };

            return (
                <div style={{
                    position: 'fixed',
                    top: 0,
                    left: 0,
                    right: 0,
                    bottom: 0,
                    background: 'rgba(0,0,0,0.5)',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    zIndex: 1000,
                    padding: '20px'
                }}>
                    <div style={{
                        background: theme.surface,
                        borderRadius: '20px',
                        padding: '24px',
                        maxWidth: '400px',
                        width: '100%'
                    }}>
                        <h3 style={{ margin: '0 0 20px 0', fontSize: '20px', fontWeight: 700 }}>Create New Project</h3>
                        
                        <div style={{ marginBottom: '16px' }}>
                            <label style={{ display: 'block', marginBottom: '8px', fontSize: '14px', fontWeight: 600 }}>
                                Project Name
                            </label>
                            <input
                                type="text"
                                value={name}
                                onChange={(e) => setName(e.target.value)}
                                placeholder="e.g., Maize Farm 2026, House Savings"
                                style={{
                                    width: '100%',
                                    padding: '12px',
                                    borderRadius: '12px',
                                    border: `2px solid ${theme.border}`,
                                    background: theme.background,
                                    fontSize: '16px',
                                    fontWeight: 600
                                }}
                            />
                        </div>

                        <div style={{ marginBottom: '16px' }}>
                            <label style={{ display: 'block', marginBottom: '8px', fontSize: '14px', fontWeight: 600 }}>
                                Project Type
                            </label>
                            <select
                                value={type}
                                onChange={(e) => setType(e.target.value)}
                                style={{
                                    width: '100%',
                                    padding: '12px',
                                    borderRadius: '12px',
                                    border: `2px solid ${theme.border}`,
                                    background: theme.background,
                                    fontSize: '16px',
                                    fontWeight: 600
                                }}
                            >
                                <option value="Savings Goal">Savings Goal</option>
                                <option value="Farming Project">Farming Project</option>
                                <option value="Business Venture">Business Venture</option>
                                <option value="Event Planning">Event Planning</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>

                        <div style={{ marginBottom: '20px' }}>
                            <label style={{ display: 'block', marginBottom: '8px', fontSize: '14px', fontWeight: 600 }}>
                                Target Amount (Optional)
                            </label>
                            <input
                                type="number"
                                value={targetAmount}
                                onChange={(e) => setTargetAmount(e.target.value)}
                                placeholder="e.g., 50000"
                                style={{
                                    width: '100%',
                                    padding: '12px',
                                    borderRadius: '12px',
                                    border: `2px solid ${theme.border}`,
                                    background: theme.background,
                                    fontSize: '16px',
                                    fontWeight: 600
                                }}
                            />
                        </div>

                        <div style={{ display: 'flex', gap: '12px' }}>
                            <button
                                onClick={onClose}
                                style={{
                                    flex: 1,
                                    padding: '14px',
                                    borderRadius: '12px',
                                    border: `2px solid ${theme.border}`,
                                    background: 'transparent',
                                    fontSize: '16px',
                                    fontWeight: 700,
                                    cursor: 'pointer'
                                }}
                            >
                                Cancel
                            </button>
                            <button
                                onClick={handleCreate}
                                style={{
                                    flex: 1,
                                    padding: '14px',
                                    borderRadius: '12px',
                                    border: 'none',
                                    background: theme.primary,
                                    color: 'white',
                                    fontSize: '16px',
                                    fontWeight: 700,
                                    cursor: 'pointer'
                                }}
                            >
                                Create Project
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        // Add Project Transaction Modal
        function AddProjectTransactionModal({ theme, type, onClose, onSave }) {
            const [amount, setAmount] = useState('');
            const [description, setDescription] = useState('');

            const handleSave = () => {
                if (amount && parseFloat(amount) > 0) {
                    onSave({
                        type,
                        amount: parseFloat(amount),
                        description
                    });
                }
            };

            return (
                <div style={{
                    position: 'fixed',
                    top: 0,
                    left: 0,
                    right: 0,
                    bottom: 0,
                    background: 'rgba(0,0,0,0.5)',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    zIndex: 1000,
                    padding: '20px'
                }}>
                    <div style={{
                        background: theme.surface,
                        borderRadius: '20px',
                        padding: '24px',
                        maxWidth: '400px',
                        width: '100%'
                    }}>
                        <h3 style={{ margin: '0 0 20px 0', fontSize: '20px', fontWeight: 700 }}>
                            Add {type === 'income' ? 'Income' : 'Expense'}
                        </h3>
                        
                        <div style={{ marginBottom: '16px' }}>
                            <label style={{ display: 'block', marginBottom: '8px', fontSize: '14px', fontWeight: 600 }}>
                                Amount (KES)
                            </label>
                            <input
                                type="number"
                                value={amount}
                                onChange={(e) => setAmount(e.target.value)}
                                placeholder="0.00"
                                style={{
                                    width: '100%',
                                    padding: '12px',
                                    borderRadius: '12px',
                                    border: `2px solid ${theme.border}`,
                                    background: theme.background,
                                    fontSize: '16px',
                                    fontWeight: 600
                                }}
                            />
                        </div>

                        <div style={{ marginBottom: '20px' }}>
                            <label style={{ display: 'block', marginBottom: '8px', fontSize: '14px', fontWeight: 600 }}>
                                Description
                            </label>
                            <input
                                type="text"
                                value={description}
                                onChange={(e) => setDescription(e.target.value)}
                                placeholder={type === 'income' ? 'e.g., Initial investment, Loan' : 'e.g., Seeds, Labor costs'}
                                style={{
                                    width: '100%',
                                    padding: '12px',
                                    borderRadius: '12px',
                                    border: `2px solid ${theme.border}`,
                                    background: theme.background,
                                    fontSize: '16px'
                                }}
                            />
                        </div>

                        <div style={{ display: 'flex', gap: '12px' }}>
                            <button
                                onClick={onClose}
                                style={{
                                    flex: 1,
                                    padding: '14px',
                                    borderRadius: '12px',
                                    border: `2px solid ${theme.border}`,
                                    background: 'transparent',
                                    fontSize: '16px',
                                    fontWeight: 700,
                                    cursor: 'pointer'
                                }}
                            >
                                Cancel
                            </button>
                            <button
                                onClick={handleSave}
                                style={{
                                    flex: 1,
                                    padding: '14px',
                                    borderRadius: '12px',
                                    border: 'none',
                                    background: type === 'income' ? theme.success : theme.danger,
                                    color: 'white',
                                    fontSize: '16px',
                                    fontWeight: 700,
                                    cursor: 'pointer'
                                }}
                            >
                                Add {type === 'income' ? 'Income' : 'Expense'}
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        // Render App
        ReactDOM.render(<FinTrackApp />, document.getElementById('root'));
    </script>
</body>
</html>
